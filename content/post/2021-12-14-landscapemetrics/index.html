---
title: "LandscapeMetrics to Calculate Percent Land Cover Classifications of Polygons"
author: "Steven DiFalco"
date: '2021-12-14'
categories: land use
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
lastmod: '2021-12-14T14:10:28-05:00'
projects: []
slug: landscapemetrics
subtitle: ''
summary: ''
tags: mapping
authors: []
---



<div id="still-work-in-progress" class="section level4">
<h4><em>still work in progress</em></h4>
</div>
<div id="i-previously-used-the-program-fragstats-a-few-times-while-in-graduate-school-but-never-quite-got-the-hang-of-it.-instead-of-struggling-with-fragstats-a-friend-and-colleague-nick-yarmey-used-the-landscapemetrics-package-to-do-the-same-calculations.-two-years-later-i-finally-found-some-time-to-play-around-with-it-and-try-it-out.-check-out-this-post-if-you-want-to-get-into-the-details-of-how-landscape-metrics-functions." class="section level4">
<h4>I previously used the program FRAGSTATS a few times while in graduate school but never quite got the hang of it. Instead of struggling with FRAGSTATS, a friend and colleague <a href="https://nicholasyarmey.weebly.com/">Nick Yarmey</a> used the LandscapeMetrics package to do the same calculations. Two years later, I finally found some time to play around with it and try it out. Check out <a href="https://cran.r-project.org/web/packages/landscapemetrics/vignettes/getstarted.html">this post</a> if you want to get into the details of how landscape metrics functions.</h4>
<div id="to-keep-things-simple-im-going-to-use-a-shapefile-with-only-one-property-in-it.-i-used-to-work-at-rockefeller-state-park-preserve-rspp-and-thought-it-would-be-interesting-to-see-what-the-different-land-cover-classifications-come-up.-the-property-includes-fields-forests-and-various-wetlands." class="section level5">
<h5>To keep things simple, I’m going to use a shapefile with only one property in it. I used to work at Rockefeller State Park Preserve (RSPP) and thought it would be interesting to see what the different land cover classifications come up. The property includes fields, forests, and various wetlands.</h5>
<pre class="r"><code>#rspp &lt;- st_read(&quot;RSPP.shp&quot;) %&gt;% st_transform(4326)

rspp &lt;- readOGR(&quot;RSPP.shp&quot;)</code></pre>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/stevendifalco/Documents/GitHub/website_copy/content/post/2021-12-14-landscapemetrics/RSPP.shp&quot;, layer: &quot;RSPP&quot;
## with 1 features
## It has 22 fields</code></pre>
<pre class="r"><code>map &lt;- ggplot(rspp, aes(x = long, y = lat, group = group)) +
  geom_polygon(color = &quot;black&quot;, size = 0.1, fill = &quot;lightgrey&quot;) +
  ggtitle(&quot;RSPP Map&quot;)+
  coord_equal() +
  theme_minimal()</code></pre>
<pre><code>## Regions defined for each Polygons</code></pre>
<pre class="r"><code>print(map)</code></pre>
<p><img src="/post/2021-12-14-landscapemetrics/index_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="nlcd-2016-raster-will-be-used-for-the-land-classifications." class="section level5">
<h5>NLCD 2016 raster will be used for the land classifications.</h5>
<pre class="r"><code>nlcd &lt;- raster(&quot;NLCD_Clipped.tif&quot;)

## get information about the raster itself
#check_landscape(nlcd) # get info on raster object

## to speed up the processes, you can clip the raster to the extent of the shapefile. I already did this step previously.
#nlcd_cropped &lt;- crop(nlcd, esmts)</code></pre>
</div>
<div id="to-mitigate-problems-with-the-projections-not-lining-up-use-sptransform-to-match-datasets.-afterwards-the-next-steps-will-calculate-the-percentage-of-each-land-cover-in-the-raster.-i-pivot-the-table-and-rename-the-columns-so-its-easier-to-understand-the-output-of-this-calculation." class="section level5">
<h5>To mitigate problems with the projections not lining up, use spTransform to match datasets. Afterwards, the next steps will calculate the percentage of each land cover in the raster. I pivot the table and rename the columns so it’s easier to understand the output of this calculation.</h5>
<pre class="r"><code>#match the spatial projectsion between shapefile and NLCD dataset 
rspp &lt;- spTransform(rspp, proj4string(nlcd))

#calculates % land cover for each type in polygon extent
rspp_nlcd &lt;- sample_lsm(landscape = nlcd, y= rspp, what= c(&quot;lsm_c_pland&quot;))</code></pre>
<pre><code>## Warning: The &#39;perecentage_inside&#39; is below 90% for at least one buffer.</code></pre>
<pre><code>## Warning: no non-missing arguments to min; returning Inf</code></pre>
<pre><code>## Warning: no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning: Please use &#39;check_landscape()&#39; to ensure the input data is valid.</code></pre>
<pre class="r"><code>head(rspp_nlcd)</code></pre>
<pre><code>## # A tibble: 6 x 8
##   layer level class    id metric   value plot_id percentage_inside
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;int&gt;             &lt;dbl&gt;
## 1     1 class    11    NA pland   3.32         1              99.9
## 2     1 class    21    NA pland   1.14         1              99.9
## 3     1 class    22    NA pland   0.409        1              99.9
## 4     1 class    23    NA pland   0.0455       1              99.9
## 5     1 class    41    NA pland  77.0          1              99.9
## 6     1 class    42    NA pland   0.0910       1              99.9</code></pre>
</div>
</div>

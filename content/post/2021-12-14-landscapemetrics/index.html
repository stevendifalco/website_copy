---
title: Landscape Metrics and Percent Land Use of Polygons
author: ''
date: '2021-12-14'
slug: landscapeMetrics
categories:
  - land use
  - post
tags:
  - landscape ecology
subtitle: ''
summary: ''
authors: []
lastmod: '2021-12-14T15:36:54-05:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<div id="still-work-in-progress" class="section level4">
<h4><em>still work in progress</em></h4>
</div>
<div id="i-previously-used-the-program-fragstats-a-few-times-while-in-graduate-school-but-never-quite-got-the-hang-of-it.-instead-of-struggling-with-fragstats-a-friend-and-colleague-nick-yarmey-used-the-landscapemetrics-package-to-do-the-same-calculations.-two-years-later-i-finally-found-some-time-to-play-around-with-it-and-try-it-out.-check-out-this-post-if-you-want-to-get-into-the-details-of-how-landscape-metrics-functions." class="section level4">
<h4>I previously used the program FRAGSTATS a few times while in graduate school but never quite got the hang of it. Instead of struggling with FRAGSTATS, a friend and colleague <a href="https://nicholasyarmey.weebly.com/">Nick Yarmey</a> used the LandscapeMetrics package to do the same calculations. Two years later, I finally found some time to play around with it and try it out. Check out <a href="https://cran.r-project.org/web/packages/landscapemetrics/vignettes/getstarted.html">this post</a> if you want to get into the details of how landscape metrics functions.</h4>
<div id="to-keep-things-simple-im-going-to-use-a-shapefile-with-only-one-property-in-it.-i-used-to-work-at-rockefeller-state-park-preserve-rspp-and-thought-it-would-be-interesting-to-see-what-the-different-land-cover-classifications-come-up.-the-property-includes-fields-forests-and-various-wetlands." class="section level5">
<h5>To keep things simple, I’m going to use a shapefile with only one property in it. I used to work at Rockefeller State Park Preserve (RSPP) and thought it would be interesting to see what the different land cover classifications come up. The property includes fields, forests, and various wetlands.</h5>
<pre class="r"><code>rspp &lt;- readOGR(&quot;RSPP.shp&quot;)</code></pre>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/stevendifalco/Documents/GitHub/website_copy/content/post/2021-12-14-landscapemetrics/RSPP.shp&quot;, layer: &quot;RSPP&quot;
## with 1 features
## It has 22 fields</code></pre>
<pre class="r"><code>map &lt;- ggplot(rspp, aes(x = long, y = lat, group = group)) +
  geom_polygon(color = &quot;black&quot;, size = 0.1, fill = &quot;lightgrey&quot;) +
  ggtitle(&quot;RSPP Map&quot;)+
  coord_equal() +
  theme_minimal()

print(map)</code></pre>
<p><img src="/post/2021-12-14-landscapemetrics/index_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="nlcd-2016-raster-will-be-used-for-the-land-classifications." class="section level5">
<h5>NLCD 2016 raster will be used for the land classifications.</h5>
<pre class="r"><code>nlcd &lt;- raster(&quot;NLCD_Clipped.tif&quot;)

## get information about the raster itself
#check_landscape(nlcd) 

## to speed up the processes, you can clip the raster to the extent of the shapefile. I already did this step previously but the code would be.
#nlcd_cropped &lt;- crop(nlcd, *area wanted to crop to*)</code></pre>
</div>
<div id="to-mitigate-problems-with-the-projections-not-lining-up-use-sptransform-to-match-datasets.-afterwards-the-next-steps-will-calculate-the-percentage-of-each-land-cover-in-the-raster.-i-pivot-the-table-and-rename-the-columns-so-its-easier-to-understand-the-output-of-this-calculation." class="section level5">
<h5>To mitigate problems with the projections not lining up, use spTransform to match datasets. Afterwards, the next steps will calculate the percentage of each land cover in the raster. I pivot the table and rename the columns so it’s easier to understand the output of this calculation.</h5>
<pre class="r"><code>#match the spatial projectsion between shapefile and NLCD dataset 
rspp &lt;- spTransform(rspp, proj4string(nlcd))

#calculates % land cover for each type in polygon extent
rspp_nlcd &lt;- sample_lsm(landscape = nlcd, y= rspp, what= c(&quot;lsm_c_pland&quot;))

head(rspp_nlcd)</code></pre>
<pre><code>## # A tibble: 6 x 8
##   layer level class    id metric   value plot_id percentage_inside
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;int&gt;             &lt;dbl&gt;
## 1     1 class    11    NA pland   3.32         1              99.9
## 2     1 class    21    NA pland   1.14         1              99.9
## 3     1 class    22    NA pland   0.409        1              99.9
## 4     1 class    23    NA pland   0.0455       1              99.9
## 5     1 class    41    NA pland  77.0          1              99.9
## 6     1 class    42    NA pland   0.0910       1              99.9</code></pre>
</div>
<div id="landscapemetric-analyzes-each-polygon-seperately-for-each-class-in-the-raster.-since-the-shapefile-was-a-multipolygon-the-tool-automatically-assigned-a-random-number-to-each-of-my-polygons-plot_id-above.-seeing-this-ill-go-back-and-add-my-own-id-so-i-know-which-is-which-polygon-from-the-analysis.-i-have-to-convert-the-shapefile-to-be-an-sf-object-to-use-st_cast-to-extract-the-multipolygon-to-singular-polygons.-then-assign-a-unique-to-each-polygon." class="section level5">
<h5>LandscapeMetric analyzes each polygon seperately for each class in the raster. Since the shapefile was a multipolygon, the tool automatically assigned a random number to each of my polygons (plot_id above). Seeing this, I’ll go back and add my own ID so I know which is which polygon from the analysis. I have to convert the shapefile to be an sf object to use st_cast() to extract the multipolygon to singular polygons. Then assign a unique # to each polygon.</h5>
<pre class="r"><code># convert shapefile to sf object
rspp_sf &lt;- as(rspp, &quot;sf&quot;)

# cast the multi to singular polygons
rspp_cast &lt;- st_cast(rspp_sf, &quot;POLYGON&quot;)

#add unique ID to each polygon
rspp_cast$ID &lt;- 1:nrow(rspp_cast)

#lets view the differnce between this and the first map
map &lt;- ggplot() + 
  geom_sf(data = rspp_cast, size = 1, color = rspp_cast$ID, fill = rspp_cast$ID) + 
  ggtitle(&quot;RSPP Map&quot;) + 
  coord_sf() +
  theme_minimal()</code></pre>
</div>
<div id="unfortunately-this-shapefile-had-multiple-small-slivers-in-it.-there-are-multiple-roads-surrounding-this-property-and-it-is-made-up-of-multiple-tax-parcels-which-caused-this-issue.-not-really-a-bad-problem-well-work-with-it-as-it-is-for-now." class="section level5">
<h5>Unfortunately, this shapefile had multiple small slivers in it. There are multiple roads surrounding this property and it is made up of multiple tax parcels, which caused this issue. Not really a bad problem, we’ll work with it as it is for now.</h5>
<pre class="r"><code>print(map)</code></pre>
<p><img src="/post/2021-12-14-landscapemetrics/index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="to-calculate-the-percentage-of-each-land-cover-per-unit-of-the-park-well-use-the-code-below.-pivoting-the-table-is-necessary-to-reconfigure-the-data-so-that-each-row-is-only-one-of-the-park-units.-the-map-is-colored-by-the-percentage-of-deciduous-forests-of-each-area." class="section level5">
<h5>To calculate the percentage of each land cover, per unit of the park, we’ll use the code below. Pivoting the table is necessary to reconfigure the data so that each row is only one of the park units. The map is colored by the percentage of ‘Deciduous’ forests of each area.</h5>
<pre class="r"><code>#calculates % land cover for each type in polygon extent
rspp_nlcd &lt;- sample_lsm(landscape = nlcd, y= rspp_cast, plot_id = rspp_cast$ID, what= c(&quot;lsm_c_pland&quot;))

#pivot to wide format consolidating by unique ID
nlcd_wide &lt;- pivot_wider(data= rspp_nlcd, names_from = class, values_from = value)

#rename land cover types
nlcd_wide&lt;- nlcd_wide %&gt;%
  rename(
    Open_Water = &#39;11&#39;,
    Dev_OS = &#39;21&#39;, 
    Barren = &#39;31&#39;, Deciduous = &#39;41&#39;, Evergreen = &#39;42&#39;, MixedForest = &#39;43&#39;,
    Shrub_Scrub = &#39;52&#39;, Grassland = &#39;71&#39;, Pasture_Hay = &#39;81&#39;,
    WoodyWet = &#39;90&#39;, EmergentWet = &#39;95&#39;
  )

#join to unique IDS
nlcd_rspp &lt;- inner_join(rspp_cast, nlcd_wide, by= c(&quot;ID&quot;=&quot;plot_id&quot;))

nlcd_rspp &lt;- nlcd_rspp[nlcd_wide$percentage_inside &gt; 0]

deciduous&lt;- ggplot(nlcd_rspp) +
  geom_sf(aes(fill = Deciduous)) +
  scale_fill_viridis_c(option = &quot;B&quot;)

print(deciduous)</code></pre>
<p><img src="/post/2021-12-14-landscapemetrics/index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
</div>
